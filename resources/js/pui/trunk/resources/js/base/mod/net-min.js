KISSY.add("net/base",function(d){var g=function(){},f={proxy:{}},e=d.DOM,c=d.Event,b=c.on;function a(h){this._init(h);}d.augment(a,{url:"",async:true,data:"",onStart:g,onSend:g,onSuccess:null,onFailure:null,onComplete:g,method:"post",xhr:null,header:null,startEventObj:{notice:"正在加载..."},completeEventObj:{},_init:function(i){d.mix(this,i);var h=this,j=this.data;if(d.isPlainObject(j)){this.data=d.param(j);}},getXhr:function(){var i=this.url,j,h=this,m,l;function n(o){var p=e.create("<a>",{href:o});return p.hostname;}j=n(i);if(j!=location.hostname&&/^http/.test(i)){if(!f.proxy[j]){m=e.create("<iframe>",{src:"http://code:81/jsBase/test/proxy.html",width:0,height:0,frameborder:0});document.body.appendChild(m);b(m,"load",function(){f.proxy[j]=m;h.xhr=m.contentWindow.getXhr();h._send();});}else{h.xhr=f.proxy[j].contentWindow.getXhr();h._send();}}else{if(d.UA.ie){try{h.xhr=new ActiveXObject("Msxml2.XMLHTTP");}catch(k){h.xhr=new ActiveXObject("Microsoft.XMLHTTP");}h._send();}else{h.xhr=new XMLHttpRequest();h._send();}}},abort:function(){this.xhr.abort();},send:function(){this.getXhr();},_send:function(){var j=this.url,m=this.method,l=null,i=this;if(m=="get"&&!!this.data){j=this.url+(/\?/.test(this.url)?"&":"?")+this.data;}else{l=this.data;}this.xhr.onreadystatechange=function(){i._onStateChange();};this.xhr.open(m,j,this.async);this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(d.isPlainObject(this.header)){for(var h in this.header){this.xhr.setRequestHeader(h,this.header[h]);}}this.xhr.send(l);},_onStateChange:function(){var h=this.xhr;if(h.readyState==1&&!this._hasStart){this.onStart();f.fire("start",{startEventObj:this.startEventObj});this._hasStart=true;}else{if(h.readyState==2){this._onSend();}else{if(h.readyState==4){if(h.status==undefined||h.status==0||(h.status>=200&&h.status<300||h.status==1223||h.status==304)){this._onSuccess();}else{(this.onError||this.onFailure||g).call(this,h);}f.fire("complete",{completeEventObj:this.comleteEventObj});this._onComplete();}}}},_onSuccess:function(){this.onSuccess(this.xhr);},_onSend:function(){this.onSend(this.xhr);},_onComplete:function(){this.onComplete(this.xhr);}});d.mix(f,{XmlHttpRequest:a,post:function(h){h.method="post";var i=new a(h);i.send();return i;},get:function(h){h.method="get";var i=new a(h);i.send();return i;}});d.mix(f,d.EventTarget);d.net=f;},{requires:["core"]});KISSY.add("mod/net",function(a){PW.net=a.net;},{requires:["net/base"]});