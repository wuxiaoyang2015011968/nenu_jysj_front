KISSY.add("mod/dialog",function(a,b){PW.namespace("dialog");PW.namespace("Dialog");PW.namespace("mod.Dialog");PW.Dialog=PW.dialog=PW.mod.Dialog=new b();},{requires:["dialog/core"]});KISSY.add("dialog/core",function(c,e){var m=c.DOM,a=m.get,i=m.query,d=jQuery,g=c.Event.on,j=c.Event.delegate,k=c.Event.detach,n=function(){},l={onClick:n,beforeOpen:n,afterOpen:n,beforeClose:n,afterClose:n,maskClickHandler:n,beforeOpenHandler:n,afterOpenHandler:n,beforeCloseHandler:n,afterCloseHandler:n},h=PW.modSettings.dialog||{},b=PW.libUrl+"js/base/assets/dialog/css/default.css";function f(o){this.opts=c.merge(l,o);this.dlgStore={length:0};this.dlgCache=window.top.PW.DLG_CACHE;this.dataCache=window.top.PW.DATA_CACHE;this.init();}c.augment(f,c.EventTarget,{init:function(){var o=this;if(c.isString(h.themeUrl)&&h.themeUrl!=""){c.getScript(h.themeUrl,{charset:"utf-8"});}else{c.getScript(b,{charset:"utf-8"});}if(!o.dlgCache){window.top.PW.DLG_CACHE=PW.mod.Cache();o.dlgCache=window.top.PW.DLG_CACHE;}if(!o.dataCache){window.top.PW.DATA_CACHE=PW.mod.Cache();o.dataCache=window.top.PW.DATA_CACHE;}},open:function(r){var p=this,q,o={};c.mix(o,h,true,true,true);c.mix(o,r,true,true,true);q=p._createDlg(o);p.dlgCache.set(q.id,q);return q;},close:function(t){var q=this,s=q.dlgCache,r,p=q.dataCache,o=null;if(!t){return;}if(s&&(r=s.get(t))){r.close();}else{c.log("要关闭的弹出窗口不存在");}},closeAll:function(){var o=this,p=o.dlgCache;if(p&&p.data.length>0){p.each(function(q,r){r.close();});}},closeThis:function(){var r=this,p=window.location.search,t=c.unparam(p.substr(1)),s=t.dlgId,u=window.top.PW.DLG_CACHE,o=r.dataCache;if(!u||!u.get(s)){return;}try{u.get(s).close();}catch(q){c.log(q);}},setData:function(v,r){var q=this,o=q.dataCache,u=q.dlgCache,t,p,s=r;if(v&&(c.isString(v)||c.isNumber(v))){t=u.get(v);}if(c.isObject(v)){var s=v;v=q._getIframeId();t=u.get(v);}if(t){o.set(t.id,s);}},getData:function(r){var p=this,o=p.dataCache,q=p.dlgCache;if(!r){r=p._getIframeId();}if(!r){return null;}return o.get(r);},alert:function(s,t,q){var r=this,o={left:"cetner",top:"center",width:400,title:"请注意",header:false,zIndex:1000},p="";o=c.merge(o,h);if(c.isObject(q)){o=c.merge(o,q);}o=c.merge(o,{footer:{btns:[{text:"确定",clickHandler:function(v,u){u.close();}}]},onClick:function(v,u){},afterClose:function(v,u){if(c.isFunction(t)){t.call(u,v,u);}}});p+='<div class="dlg-alert">';p+='<i class="alert-ico"></i>';p+="<p>"+(s)?s:"null<p>";p+="</div>";o.content=p;return r.open(o);},confirm:function(u,p,o,s){var t=this,q={left:"cetner",top:"center",width:400,title:"确认:",header:false,zIndex:1000},r="";q=c.merge(q,h);if(c.isObject(s)){q=c.merge(q,s);}q=c.merge(q,s,{footer:{btns:[{text:"确定",clickHandler:function(w,v){if(c.isFunction(p)){p.call(v,w,v);}v.close();}},{text:"取消",clickHandler:function(w,v){if(c.isFunction(o)){o.call(v,w,v);}v.close();}}]},onClick:function(w,v){}});r+='<div class="dlg-confirm">';r+='<i class="confirm-ico"></i>';r+="<p>"+(u)?u:"null<p>";r+="</div>";q.content=r;return t.open(q);},prompt:function(s,u,t,q){var r=this,o={left:"center",top:"center",width:400,zIndex:1000},p="";o=c.merge(o,h);if(c.isObject(q)){o=c.merge(o,q);}o=c.merge(o,{title:c.isString(s)?s:"输入",footer:{btns:[{text:"提交",clickHandler:function(x,w){var z=w.dlgEl,v=a("textarea",z),y=m.val(v);if(t&&c.isFunction(t)){t(x,w,y);}w.close();}},{text:"取消",clickHandler:function(w,v){v.close();}}]},onClick:function(w,v){}});p+='<div class="dlg-prompt">';p+='<textarea placeholder="';p+=(u)?u:"";p+='"></textarea>';p+="</div>";o.content=p;return r.open(o);},_getIframeId:function(){var p=this,o=window.location.search,q=c.unparam(o.substr(1));return q.dlgId;},_createDlg:function(r){var o=this,s=o.dlgCache,q=c.merge(l,r),p;p=new e(r);p.on("click",function(u){var t=q.onClick,v=q.maskClickHandler;if(c.isFunction(t)){t(u,this);}if(c.isFunction(v)){v(u,this);}});p.on("beforeOpen",function(v){var u=q.beforeOpen,t=q.beforeOpenHandler;if(c.isFunction(u)){u();}if(c.isFunction(t)){t(v,this);}});p.on("afterOpen",function(v){var u=q.afterOpen,t=q.afterOpenHandler;if(c.isFunction(u)){u(v,this);}if(c.isFunction(t)){t(v,this);}});p.on("beforeClose",function(u){var t=q.beforeClose,v=q.beforeCloseHandler;if(c.isFunction(t)){t(u,this);}if(c.isFunction(v)){v(u,this);}});p.on("afterClose",function(v){var u=q.afterClose,t=q.afterCloseHandler;s.remove(this.id);if(c.isFunction(u)){u(v,this);}if(c.isFunction(t)){t(v,this);}});p.open();return p;}});return f;},{requires:["dialog/base","mod/cache","core"]});KISSY.add("dialog/base",function(c){var k=c.DOM,b=k.get,g=k.query,d=jQuery,f=c.Event.on,h=c.Event.delegate,i=c.Event.detach,j={width:600,height:"auto",position:"absolute",left:"center",top:200,zIndex:200,topLayer:0,theme:"a",_x_:true,header:true,icon:undefined,title:"新建窗口",content:"没有任何内容",contentFrame:undefined,frameScroll:"no",footer:undefined,_dlgCtrlId:null,hasOverlay:true,maskColor:"#000",maskOpacity:0.6,maskCursor:"wait"},a="dlg-inner-frame";function e(l){this.opts=c.merge(j,l);this.overlay;this.id=c.now();this.win;this.doc;this.dlgEl;this.openStatus=false;this.dataCache=window.top.PW.DATA_CACHE;this.init();}c.augment(e,c.EventTarget,{init:function(){var l=this;if(!l.dataCache){window.top.PW.DATA_CACHE=PW.mod.Cache();l.dataCache=window.top.PW.DATA_CACHE;}l._checkParam();l._getWin();l._createOverlay();l._createDlgEl();l.addEvtDispatcher();},addEvtDispatcher:function(){var n=this,m=n.opts,l=n.overlay;if(m.hasOverlay){l.on("resize",function(){n.fire("resize",{obj:n,cache:n._getData()});n._fixStyle(n.dlgEl);});l.on("click",function(o){n.fire("click",{obj:n,cache:n._getData()});});}},open:function(){var l=this;if(!l.openStatus){l._openAction();}else{c.log("编号为"+l.id+"的弹出层已经打开");}},close:function(){var l=this;if(l.openStatus){l._closeAction();}else{c.log("标号为"+l.id+"的弹出层已经关闭");}},_openAction:function(){var m=this,l=m.opts;m.fire("beforeOpen",{obj:m,cache:m._getData()});if(l.hasOverlay){m.overlay.render();}k.append(m.dlgEl,m.doc.body);if(l.hasOverlay){m.overlay.refresh();}m._fixStyle(m.dlgEl);m.openStatus=true;m.fire("afterOpen",{obj:m,cache:m._getData()});},_closeAction:function(){var m=this,l=m.opts;m.fire("beforeClose",{obj:m,cache:m._getData()});if(l.hasOverlay){m.overlay.destroy();}k.remove(m.dlgEl);m.openStatus=false;m.fire("afterClose",{obj:m,cache:m._getData()});},_getData:function(){var m=this,l=m.dataCache;return l.get(m.id);},_createOverlay:function(){var m=this,l=m.opts;if(l.hasOverlay){m.overlay=PW.mod.Overlay({topLayer:l.topLayer,bgColor:l.maskColor,zIndex:l.zIndex-1,cursor:l.maskCursor,opacity:l.maskOpacity});}},_createDlgEl:function(){var p=this,q=p.opts,B="",l,D,x,v={},s,z,m,E;B+='<div class="cpt-dlg-outer theme-'+q.theme+'" theme="theme-'+q.theme+'" id="dlg-'+p.id+'">';B+='<div class="dlg-holder">';B+='<table cellpadding="0" cellspacing="0" border="0" >';if(q.header){B+="<thead>";B+="<tr>";B+='<th class="header-holder">';B+='<div class="dlg-header">';if(q.icon){B+='<i class="dlg-icon" style="background:url('+q.icon+') center center no-repeat;"></i>';B+='<h2 class="dlg-title">'+q.title+"</h2>";}else{B+='<h2 class="dlg-title no-icon">'+q.title+"</h2>";}if(q._x_){B+='<a class="dlg-close">×</a>';}B+="</div>";B+="</th>";B+=" </tr>";B+=" </thead>";}B+=" <tbody>";B+=" <tr>";B+=' <td class="content-holder">';B+='<div class="dlg-content">';B+="</div>";B+="</td>";B+="</tr>";B+="</tbody>";if(q.footer&&q.footer.btns&&c.isArray(q.footer.btns)){B+="<tfoot>";B+='<td class="footer-holder">';B+='<div class="dlg-footer">';B+="</div>";B+="</td>";B+="</tfoot>";}B+="</table>";B+="</div>";B+="</div>";l=k.create(B,p.win);x=b(".dlg-content",l);k.height(x,q.height);if(q.isFrame){var t=/\?[\S]*/,A,n="";A=(t.test(q.contentFrame))?"&":"?";n=q.contentFrame+A+"dlgId="+p.id+"&top="+q.topLayer+"&dlgCtrlId="+q._dlgCtrlId;s=k.create("<iframe>",{"class":a,frameborder:"0",scrolling:q.frameScroll,allowtransparency:"true",frameborder:"0",src:n,height:(q.height=="auto")?400:"100%"});k.append(s,x);}else{k.append(q.content,x);}if(q.footer&&q.footer.btns&&c.isArray(q.footer.btns)){fbtns=q.footer.btns;var m=b(".dlg-footer",l),o=function(r){this.DO=function(F){r.clickHandler(F,p);};};if(fbtns.length>0){for(var y=0;y<fbtns.length;y++){var w=fbtns[y],C=k.create("<button>",{type:"button",text:w.text,bid:w.bid});var u=new o(w);f(C,"click",u.DO);k.append(C,m);}}}E=b(".dlg-close",l);f(E,"click",function(r){p.fire("clickBtn",{obj:p});p._closeAction();});p._fixStyle(l);p.dlgEl=l;},_fixStyle:function(n){var p=this,o=p.opts,m={},l=function(r){var q=d(window).scrollTop();d(n).css({top:q+r});};m={width:o.width,position:o.position,zIndex:o.zIndex};if(c.isNumber(o.left)){m.left=o.left;}else{m.left="50%";m.marginLeft=k.outerWidth(n)/2*-1;}if(c.isNumber(o.top)){m.top=o.top;}else{m.top=(d(p.win).outerHeight()-d(n).outerHeight())/2;if(m.top<0){m=0;}}if(o.position=="fixed"&&PW.mod.Sniffer.browser.isIE6){m.position="absolute";d(window).on("scroll",function(){l(m.top);});}if(o.position!="fixed"&&!c.isNumber(o.top)){m.top=(o.hasOverlay)?p.overlay.h/2:d(p.doc).height()/2;m.marginTop=d(n).outerHeight()/2*-1;}k.css(n,m);},_checkParam:function(){var v=this,m=v.opts,w=PW.mod.Pattern(),p=/^\d+[.\d+]?|center/,q=/^[#|.]([A-Za-z0-9|-|_]+[A-Za-z0-9|-|_|\s]*)/,l=/(^[#]([a-fA-F0-9]{6}|[a-fA-F0-9]{3}))|([a-zA-Z]+)/,s=/^\d+$/,u=/([0-9]*)(.[0-9]+)?/,y=/([0]?[.]{1}[0-9]+)|0|1/,x=/absolute|fixed/,n=/^(http|https|ftp):\/\/[a-zA-Z0-9|:|\/|-|_]+/,o=/yes|no|auto/,z=/([0-9]+(.[0-9]+)?)|auto/;try{if(!w.test("isNumber",m.height)){c.log("高度自动修正为auto");m.height="auto";}if(!w.test("isNumber",m.left)){c.log("左偏移错误，自动修正为center");m.left="center";}if(!w.test("isNumber",m.top)){c.log("顶部偏移错误，自动修正为cetner");m.top="center";}if(m.position!="fixed"){m.position="absolute";}var t=m.content;if(w.test("isUrl",m.contentFrame)){m.isFrame=true;}else{if(c.isString(t)){if(w.test(q,t)&&b(t)!=null){m.content=g(t);}else{m.content=k.create(t);}}else{if(v._isHTMLElement(t)){}else{if(c.isObject(t)&&t.jQuery!=undefined&&t.length>0){m.content=t.get();}else{if(c.isObject(t)&&t.length>0){m.content=t.getDOMNodes();}else{m.content=k.create(j.content);}}}}}}catch(r){c.log(r);}},_getWin:function(){var n=this,m=n.opts,o=window;for(var l=0;l<m.topLayer;l++){o=o.parent;}n.win=o;n.doc=o.document;},_isHTMLElement:function(m){var n=document.createElement("div");try{n.appendChild(m.cloneNode(true));return m.nodeType==1?true:false;}catch(l){return false;}}});return e;},{requires:["mod/overlay","mod/pattern","mod/sniffer","core","sizzle"]});