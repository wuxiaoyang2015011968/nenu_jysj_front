/*
Copyright 2012, KISSY UI Library v1.20
MIT Licensed
build time: Apr 24 20:15
*/
KISSY.add("dd/ddm",function(h,k,l,f,d,a){function i(){i.superclass.constructor.apply(this,arguments)}function e(o,a){var c=o.get("activeDrag"),e=c.get("mode"),j=o.get("drops"),d,f=0,n=0,i=m(c.get("node")),k=b(i);h.each(j,function(o){var j;if(j=o.getNodeFromTarget(a,c.get("dragNode")[0],c.get("node")[0]))if("point"==e)g(m(j),c.mousePos)&&(j=b(m(j)),d?j<n&&(d=o,n=j):(d=o,n=j));else if("intersect"==e)j=b(v(i,m(j))),j>n&&(n=j,d=o);else if("strict"==e&&(j=b(v(i,m(j))),j==k))return d=o,!1});if((f=o.get("activeDrop"))&&
f!=d)f._handleOut(a),c._handleOut(a);o.set("activeDrop",d);d&&(f!=d?d._handleEnter(a):d._handleOver(a))}function c(b){var a=document;b._shim=(new d("<div style='background-color:red;position:"+(x?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+q.get("dragCursor")+";z-index:"+w+";'></div>")).prependTo(a.body||a.documentElement).css("opacity",0);c=n;if(x)f.on(y,"resize scroll",u,b);n(b)}function n(b){var a=b.get("activeDrag").get("activeHandler"),c="auto";a&&(c=a.css("cursor"));"auto"==
c&&(c=b.get("dragCursor"));b._shim.css({cursor:c,display:"block"});x&&u.call(b)}function m(b){var a=b.offset();return{left:a.left,right:a.left+b.outerWidth(),top:a.top,bottom:a.top+b.outerHeight()}}function g(b,a){return b.left<=a.left&&b.right>=a.left&&b.top<=a.top&&b.bottom>=a.top}function b(b){return b.top>=b.bottom||b.left>=b.right?0:(b.right-b.left)*(b.bottom-b.top)}function v(b,a){var c=Math.max(b.top,a.top),j=Math.min(b.right,a.right),v=Math.min(b.bottom,a.bottom);return{left:Math.max(b.left,
a.left),right:j,top:c,bottom:v}}var j=document,y=window,x=6===k.ie,p=h.throttle(function(b){var a=this.__activeToDrag,c=this.get("activeDrag");(c||a)&&b.preventDefault();c?(c._move(b),e(this,b)):a&&a._move(b)},30),w=999999;i.ATTRS={prefixCls:{value:"ks-dd-"},dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]}};var u=h.throttle(function(){var b;(b=this.get("activeDrag"))&&b.get("shim")&&this._shim.css({width:l.docWidth(),height:l.docHeight()})},
30);h.extend(i,a,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unregDrop:function(b){b=h.indexOf(b,this.get("drops"));-1!=b&&this.get("drops").splice(b,1)},_regToDrag:function(b){f.on(j,"mouseup",this._end,this);f.on(j,"mousemove",p,this);this.__activeToDrag=b},_start:function(){var b=this.__activeToDrag;this.set("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&c(this);this.fire("dragstart",{drag:b})},_end:function(){var b=this.get("activeDrag"),a=this.get("activeDrop"),c=
{drag:b,drop:a};f.remove(j,"mousemove",p,this);f.remove(j,"mouseup",this._end,this);this.__activeToDrag&&(this.__activeToDrag._end(),this.__activeToDrag=0);this._shim&&this._shim.hide();b&&(b._end(),a?(a._end(),this.fire("drophit",c),this.fire("dragdrophit",c)):this.fire("dragdropmiss",{drag:b}),this.fire("dragend",{drag:b}),this.set("activeDrag",null),this.set("activeDrop",null))}});var q=new i;q.inRegion=g;q.region=m;q.area=b;return q},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable",function(h,k,l,f,d){function a(){a.superclass.constructor.apply(this,arguments);this._init()}function i(){return!1}function e(b){var a=b.target;this._checkMouseDown(b)&&this._check(a)&&this._prepare(b)}var c=h.each,n=k.ie,m=document;a.POINT="point";a.INTERSECT="intersect";a.STRICT="strict";a.ATTRS={node:{setter:function(b){return l.one(b)}},clickPixelThresh:{valueFn:function(){return d.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return d.get("bufferTime")}},dragNode:{},
shim:{value:!0},handlers:{value:[],getter:function(b){var a=this;b.length||(b[0]=a.get("node"));c(b,function(c,g){h.isFunction(c)&&(c=c.call(a));if(h.isString(c)||c.nodeType)c=l.one(c);b[g]=c});a.__set("handlers",b);return b}},activeHandler:{},dragging:{value:!1,setter:function(b){this.get("dragNode")[b?"addClass":"removeClass"](d.get("prefixCls")+"dragging")}},mode:{value:"point"},disabled:{value:!1,setter:function(b){this.get("dragNode")[b?"addClass":"removeClass"](d.get("prefixCls")+"-disabled");
return b}},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0}};var g;h.extend(a,f,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_init:function(){var b=this.get("node");this.set("dragNode",b);b.on("mousedown",e,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(b){b.preventDefault()},destroy:function(){this.get("dragNode").detach("mousedown",e,this).detach("dragstart",this._fixDragStart);this.detach()},_check:function(b){var a=this,g=a.get("handlers"),e=
0;c(g,function(c){if(c.contains(b)||c[0]==b)return e=1,a.set("activeHandler",c),!1});return e},_checkMouseDown:function(b){return this.get("primaryButtonOnly")&&1<b.button||this.get("disabled")?0:1},_prepare:function(b){var a=this;n&&(g=m.body.onselectstart,m.body.onselectstart=i);a.get("halt")?b.halt():b.preventDefault();var c=a.get("node"),e=b.pageX,b=b.pageY,c=c.offset();a.startMousePos=a.mousePos={left:e,top:b};a.startNodePos=c;a._diff={left:e-c.left,top:b-c.top};d._regToDrag(a);if(e=a.get("bufferTime"))a._bufferTimer=
setTimeout(function(){a._start()},e)},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(b){var a,c=this._diff;a=this.startMousePos;var g=b.pageX,b=b.pageY,e=g-c.left,c=b-c.top;this.get("dragging")?(this.mousePos={left:g,top:b},a={left:e,top:c,pageX:g,pageY:b,drag:this},g=1,!1===this.fire("drag",a)&&(g=0),!1===d.fire("drag",a)&&(g=0),g&&this.get("move")&&this.get("node").offset(a)):(c=this.get("clickPixelThresh"),(Math.abs(g-a.left)>=
c||Math.abs(b-a.top)>=c)&&this._start())},_end:function(){var b;this._clearBufferTimer();n&&(m.body.onselectstart=g);this.get("dragging")&&(this.get("node").removeClass(d.get("prefixCls")+"drag-over"),(b=d.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this}),this.set("dragging",0),this.fire("dragend",{drag:this}))},_handleOut:function(){this.get("node").removeClass(d.get("prefixCls")+"drag-over");this.fire("dragexit",{drag:this,drop:d.get("activeDrop")})},
_handleEnter:function(b){this.get("node").addClass(d.get("prefixCls")+"drag-over");this.fire("dragenter",b)},_handleOver:function(b){this.fire("dragover",b)},_start:function(){this._clearBufferTimer();this.set("dragging",1);d._start();this.fire("dragstart",{drag:this})}});return a},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable",function(h,k,l,f){function d(){d.superclass.constructor.apply(this,arguments);this._init()}d.ATTRS={node:{setter:function(a){if(a)return k.one(a)}}};h.extend(d,l,{getNodeFromTarget:function(a,d,e){var a=this.get("node"),c=a[0];return c==d||c==e?null:a},_init:function(){f._regDrop(this)},__getCustomEvt:function(a){return h.mix({drag:f.get("activeDrag"),drop:this},a)},_handleOut:function(){var a=this.__getCustomEvt();this.get("node").removeClass(f.get("prefixCls")+"drop-over");
this.fire("dropexit",a);f.fire("dropexit",a);f.fire("dragexit",a)},_handleEnter:function(a){a=this.__getCustomEvt(a);a.drag._handleEnter(a);this.get("node").addClass(f.get("prefixCls")+"drop-over");this.fire("dropenter",a);f.fire("dragenter",a);f.fire("dropenter",a)},_handleOver:function(a){a=this.__getCustomEvt(a);a.drag._handleOver(a);this.fire("dropover",a);f.fire("dragover",a);f.fire("dropover",a)},_end:function(){var a=this.__getCustomEvt();this.get("node").removeClass(f.get("prefixCls")+"drop-over");
this.fire("drophit",a)},destroy:function(){f._unregDrop(this)}});return d},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(h,k,l){function f(){f.superclass.constructor.apply(this,arguments);this[d]={}}var d="__proxy_destructors",a=h.stamp,i=h.guid("__dd_proxy"),e="__proxy";f.ATTRS={node:{value:function(a){return new k(a.get("node").clone(!0))}},destroyOnEnd:{value:!1},moveOnEnd:{value:!0}};h.extend(f,l,{attach:function(c){function f(){var b=g.get("node"),a=c.get("node");g[e]?b=g[e]:h.isFunction(b)&&(b=b(c),b.addClass("ks-dd-proxy"),b.css("position","absolute"),g[e]=b);a.parent().append(b);
b.show();b.offset(a.offset());c.__set("dragNode",a);c.__set("node",b)}function m(){var b=g[e];g.get("moveOnEnd")&&c.get("dragNode").offset(b.offset());g.get("destroyOnEnd")?(b.remove(),g[e]=0):b.hide();c.__set("node",c.get("dragNode"))}var g=this,b=a(c,1,i);if(!b||!g[d][b])c.on("dragstart",f),c.on("dragend",m),b=a(c,0,i),g[d][b]={drag:c,fn:function(){c.detach("dragstart",f);c.detach("dragend",m)}}},unAttach:function(c){var c=a(c,1,i),e=this[d];c&&e[c]&&(e[c].fn(),delete e[c])},destroy:function(){var a=
this.get("node"),e=this[d];a&&!h.isFunction(a)&&a.remove();for(var f in e)this.unAttach(e[f].drag)}});return f},{requires:["node","base"]});
KISSY.add("dd/draggable-delegate",function(h,k,l,f,d){function a(){a.superclass.constructor.apply(this,arguments)}function i(a){var c,f;if(this._checkMouseDown(a)){c=this.get("handlers");var h=new d(a.target);(c=c.length?this._getHandler(h):h)&&(f=this._getNode(c));f&&(this.__set("activeHandler",c),this.__set("node",f),this.__set("dragNode",f),this._prepare(a))}}h.extend(a,l,{_init:function(){this.get("container").on("mousedown",i,this).on("dragstart",this._fixDragStart)},_getHandler:function(a){for(var c,
d=this.get("container"),i=this.get("handlers");a&&a[0]!==d[0];){h.each(i,function(g){if(f.test(a[0],g))return c=a,!1});if(c)break;a=a.parent()}return c},_getNode:function(a){return a.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach("mousedown",i,this).detach("dragstart",this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(a){return d.one(a)}},selector:{},handlers:{value:[],getter:0},disabled:{setter:function(a){this.get("container")[a?
"addClass":"removeClass"](k.get("prefixCls")+"-disabled");return a}}}});return a},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/droppable-delegate",function(h,k,l,f,d){function a(){var a=this.get("container"),c=this.get("selector");this.__allNodes=a.all(c)}function i(){i.superclass.constructor.apply(this,arguments);k.on("dragstart",a,this)}h.extend(i,l,{getNodeFromTarget:function(a,c,d){var f={left:a.pageX,top:a.pageY},a=this.__allNodes,g=0,b=Number.MAX_VALUE;a&&a.each(function(a){var e=a[0];if(!(e===d||e===c)&&k.inRegion(k.region(a),f))e=k.area(k.region(a)),e<b&&(b=e,g=a)});g&&(this.set("lastNode",this.get("node")),
this.set("node",g));return g},_handleOut:function(){i.superclass._handleOut.apply(this,arguments);this.set("node",0);this.set("lastNode",0)},_handleOver:function(a){var c=this.get("node"),d=i.superclass._handleOut,f=i.superclass._handleOver,g=i.superclass._handleEnter,b=this.get("lastNode");b[0]!==c[0]?(this.set("node",b),d.apply(this,arguments),this.set("node",c),g.call(this,a)):f.call(this,a)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return d.one(a)}}}});return i},{requires:["./ddm",
"./droppable","dom","node"]});
KISSY.add("dd/scroll",function(h,k,l,f,d){function a(){a.superclass.constructor.apply(this,arguments);this[n]={}}var i=window,e=h.stamp,c=100,n="__dd_scrolls";a.ATTRS={node:{valueFn:function(){return f.one(i)},setter:function(a){return f.one(a)}},rate:{value:[10,10]},diff:{value:[20,20]}};var m=h.isWindow;h.extend(a,l,{getRegion:function(a){return m(a[0])?{width:d.viewportWidth(),height:d.viewportHeight()}:{width:a.outerWidth(),height:a.outerHeight()}},getOffset:function(a){return m(a[0])?{left:d.scrollLeft(),
top:d.scrollTop()}:a.offset()},getScroll:function(a){return{left:a.scrollLeft(),top:a.scrollTop()}},setScroll:function(a,b){a.scrollLeft(b.left);a.scrollTop(b.top)},unAttach:function(a){var b,c=this[n];if((b=e(a,1,"__dd-scroll-id-"))&&c[b])c[b].fn(),delete c[b]},destroy:function(){var a=this[n],b;for(b in a)this.unAttach(a[b].drag)},attach:function(a){function b(){if(m(p[0]))return 0;var b=a.mousePos,c=k.region(p);return!k.inRegion(c,b)?(clearTimeout(t),t=0,1):0}function d(c){!c.fake&&!b()&&(s=c,
r=h.clone(a.mousePos),c=l.getOffset(p),r.left-=c.left,r.top-=c.top,t||i())}function f(){clearTimeout(t);t=null}function i(){if(!b()){var d=l.getRegion(p),f=d.width,d=d.height,e=l.getScroll(p),k=h.clone(e),j=!1;r.top-d>=-o[1]&&(e.top+=q[1],j=!0);r.top<=o[1]&&(e.top-=q[1],j=!0);r.left-f>=-o[0]&&(e.left+=q[0],j=!0);r.left<=o[0]&&(e.left-=q[0],j=!0);j?(l.setScroll(p,e),t=setTimeout(i,c),s.fake=!0,m(p[0])&&(e=l.getScroll(p),s.left+=e.left-k.left,s.top+=e.top-k.top),a.get("move")&&a.get("node").offset(s),
a.fire("drag",s)):t=null}}var l=this,p=l.get("node"),w=e(a,0,"__dd-scroll-id-"),u=l[n];if(!u[w]){var q=l.get("rate"),o=l.get("diff"),s,r,t=null;a.on("drag",d);a.on("dragend",f);u[w]={drag:a,fn:function(){a.detach("drag",d);a.detach("dragend",f)}}}}});return a},{requires:["./ddm","base","node","dom"]});KISSY.add("dd",function(h,k,l,f,d,a,i,e){k={Draggable:l,Droppable:f,DDM:k,Proxy:d,DraggableDelegate:a,DroppableDelegate:i,Scroll:e};h.mix(h,k);return k},{requires:"dd/ddm,dd/draggable,dd/droppable,dd/proxy,dd/draggable-delegate,dd/droppable-delegate,dd/scroll".split(",")});
