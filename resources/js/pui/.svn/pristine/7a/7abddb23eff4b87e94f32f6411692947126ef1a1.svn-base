KISSY.add("mod/calendar",function(a,b){PW.namespace("mod.Calendar");PW.mod.Calendar=b;},{requires:["cal/core"]});KISSY.add("cal/core",function(b,g){var c=b.DOM,a=c.get,e=c.query,d="data-calendar-id";var f={version:"2.0.0",instances:[],_nextCalId:0,client:function(k){var j=this,i=a(k.renderTo),h;if(!!i){if(j._hasBuild(i)){b.log("此节点下已经有日历了，请检查","warn","PW/mod/calendar");return null;}h=new g(i,k,j._nextCalId++);j.instances.push(h);}return h;},_hasBuild:function(h){var j=this,i=c.attr(h,d);return i&&i!="";}};return f;},{requires:["cal/client"]});KISSY.add("cal/client",function(e,a){var l=e.DOM,b=l.get,i=l.query,f=e.all,j=function(){},k={select:{rangeSelect:false,minDate:null,maxDate:null,showTime:false,dateFmt:null,selected:null,disabled:null},style:{themeUri:PW.libUrl+"js/base/assets/calendar/css/style.css",pages:1,popup:true,startWeek:0,startDay:new Date(e.now()),closable:true},events:{select:j,rangeSelect:j,monthChange:j,timeSelect:j}},g=PW.modSettings.CAL_SETTTINGS||{},h="ks-select-calendar",d="data-calendar-id";var c=function(m,o,n){this._ksCal;this._opts;this._calId=n;this._trigger=m;this._init(o);};e.augment(c,e.EventTarget,{_init:function(n){var m=this;m._stamp();m._buildParam(n);m._loadStyle();m.render();m._addEvtDispathcer();},_addEvtDispathcer:function(){var m=this;m._ksCal.on("rangeSelect",m._rangeSelectHandler,m);m._ksCal.on("select",m._selectHandler,m);m._ksCal.on("timeSelect",m._timeSelectHandler,m);m._ksCal.on("monthChange",m._monthChangeHandler,m);},_selectHandler:function(q){var p=this,o=p._opts,n=p._trigger,m=q.date;if(e.isFunction(o.events.select)&&o.events.select.call(this,n,m)==false){e.log("回调阻止继续写入");return;}else{if(!o.select.rangeSelect){p._writeDate(m);}}p.fire("select",{date:m});},_rangeSelectHandler:function(q){var p=this,o=p._opts,n=p._trigger,r=q.start,m=q.end;if(e.isFunction(o.events.rangeSelect)&&o.events.rangeSelect.call(this,n,r,m)==false){return;}else{if(o.select.rangeSelect){p._writeDate(r,m);}}p.fire("rangeSelect",{start:r,end:m});},_timeSelectHandler:function(q){var p=this,o=p._opts,n=p._trigger,m=q.date;if(e.isFunction(o.events.timeSelect)&&o.events.timeSelect.call(this,n,m)==false){e.log("回调阻止继续写入");return;}else{p._writeDate(m);}p.fire("timeSelect",{date:m});},_monthChangeHandler:function(q){var p=this,o=p._opts,n=p._trigger,m=q.date,r=m.getMonth();if(e.isFunction(o.events.monthChange)){o.events.monthChange.call(n,r);}p.fire("monthChange",{date:m,month:r});},_buildParam:function(o){var n=this,m={};e.mix(m,k,true,[],true);e.mix(m,g,true,[],true);e.mix(m,o,true,[],true);if(!m.select.dateFmt){if(m.select.showTime){m.select.dateFmt="YYYY-MM-DD HH:mm:ss";}else{m.select.dateFmt="YYYY-MM-DD";}}n._opts=m;},_parseParam:function(o){var n=this,m={};m.date=n.fmtDate(o.style.startDay);m.selected=n.fmtDate(o.select.selected);m.startDay=o.style.startWeek;m.pages=o.style.pages;m.closable=o.style.closable;m.rangeSelect=o.select.rangeSelect;m.minDate=n.fmtDate(o.select.minDate);m.maxDate=n.fmtDate(o.select.maxDate);m.popup=o.style.popup;m.showTime=o.select.showTime;m.disabled=o.select.disabled;return m;},_writeDate:function(u,n){var r=this,o=r._trigger,q=r._opts,m=q.select.dateFmt,p,t;p=(e.isDate(u))?e.moment(u):null;t=(e.isDate(n))?e.moment(n):null;if(!p){e.log("传入日期数据有误","warn","pw/mod/calendar");}if(p&&!t){l.val(o,p.format(m));}if(p&&t){l.val(o,p.format(m)+"~"+t.format(m));}o.focus();},_render:function(n){var o=this,m=o._trigger;o._ksCal=new a(m,n);},render:function(m){var o=this,n=o._opts;if(!m){m=o._parseParam(n);}o._render(m);},refresh:function(n){var m=this;m.destroy();m._init(n);},select:function(n){var p=this,o=p._opts,m=e.clone(o);e.mix(m,{select:{selected:n}});p.render(p._parseParam(m));p.show();},show:function(){var m=this;m._ksCal.show();},hide:function(){var m=this;m._ksCal.hide();},destroy:function(){var n=this,m=n._trigger;n.hide();l.removeClass(m,h);l.removeAttr(m,d);n._ksCal.destroy();},fmtDate:function(q,m){var p=this,o=p._opts,r=null;if(!q){return r;}if(e.isDate(q)){return q;}try{if(!m){m=o.select.dateFmt;}if(q){r=e.moment(q,m);}}catch(n){e.log(n);}return r.toDate();},_stamp:function(){var o=this,m=o._trigger,n=o._calId;l.addClass(m,h);l.attr(m,d,n);},_loadStyle:function(){var n=this,m=n._opts;if(m.style&&e.isString(m.style.themeUri)){e.loadCSS(m.style.themeUri);}}});return c;},{requires:["kscal/index","mod/moment","mod/ext"]});KISSY.add("kscal/base",function(c,f,g,b){var i=g.Target,h=c.DOM,e=c.UA,d=f.all;function a(k,j){this._init(k,j);}c.augment(a,i,{_init:function(j,m){var k=this,l=d(j);k.id=k._stamp(l);k._buildParam(m);if(!k.popup){k.con=l;}else{k.trigger=l;k.con=new f("<div>");d(document.body).append(k.con);k.con.css({top:"0px",position:"absolute",background:"white",visibility:"hidden","z-index":99999999});}k.C_Id=k._stamp(k.con);k.render();k._buildEvent();return this;},render:function(l){var s=this,p=0,j,n,q;l=l||{};s._parseParam(l);s.con.addClass("ks-cal-call ks-clearfix ks-cal-call-multi-"+s.pages);s.ca=s.ca||[];for(var p=0;p<s.ca.length;p++){s.ca[p].detachEvent();}if(s.__shimEl){s.__shimEl.remove();delete s.__shimEl;}s.con.empty();s.ca.length=s.pages;var r=false;var m=false;if(s.range){if(s.range.start){r=true;}if(s.range.end){m=true;}}if(r&&!s.rangeLinkage){q=[s.range.start.getFullYear(),s.range.start.getMonth()];}else{q=[s.year,s.month];}for(p=0;p<s.pages;p++){if(p===0){if(r){s._time=c.clone(s.range.start);}j=true;}else{if(!s.rangeLinkage){if(m){s._time=c.clone(s.range.end);}j=true;if(m&&(p+1)==s.pages){q=[s.range.end.getFullYear(),s.range.end.getMonth()];}else{q=s._computeNextMonth(q);}}else{if(m){s._time=c.clone(s.range.end);}j=false;q=s._computeNextMonth(q);}}if(!s.rangeLinkage){n=true;}else{n=p==(s.pages-1);}var k=s.ca[p];if(!s.rangeLinkage&&k&&(k.year!=q[0]||k.month!=q[1])){q=[k.year,k.month];}s.ca[p]=new s.Page({year:q[0],month:q[1],prevArrow:j,nextArrow:n,showTime:s.showTime},s);s.ca[p].render();}if(s.popup&&e.ie===6){s.__shimEl=new f("<iframe frameBorder='0' style='position: absolute;border: none;width: expression(this.parentNode.offsetWidth-3);top: 0;left: 0;z-index: 0;height: expression(this.parentNode.offsetHeight-3);'></iframe>");s.con.prepend(s.__shimEl);}return this;},destroy:function(){var j=this;for(var k=0;k<j.ca.length;k++){j.ca[k].detachEvent();}c.each(j.EV,function(l){if(l){l.target.detach(l.type,l.fn);}});j.con.remove();},_stamp:function(j){if(!j.attr("id")){j.attr("id",c.guid("K_Calendar"));}return j.attr("id");},_buildEvent:function(){var j=this,l,k;if(!j.popup){return this;}c.each(j.EV,function(m){if(m){m.target.detach(m.type,m.fn);}});j.EV=j.EV||[];l=j.EV[0]={target:d(document),type:"click"};l.fn=function(o){var n=d(o.target);if(n.attr("id")===j.C_Id){return;}if((n.hasClass("ks-next")||n.hasClass("ks-prev"))&&n[0].tagName==="A"){return;}if(n.attr("id")==j.id){return;}if(j.con.css("visibility")=="hidden"){return;}if(j.con.contains(n)&&(n[0].nodeName.toLowerCase()==="option"||n[0].nodeName.toLowerCase()==="select")){return;}var m=function(p,q){return p[0]>q[0].x&&p[0]<q[1].x&&p[1]>q[0].y&&p[1]<q[1].y;};if(!m([o.pageX,o.pageY],[{x:j.con.offset().left,y:j.con.offset().top},{x:j.con.offset().left+j.con.width(),y:j.con.offset().top+j.con.height()}])){j.hide();}};l.target.on(l.type,l.fn);for(k=0;k<j.triggerType.length;k++){l=j.EV[k+1]={target:d("#"+j.id),type:j.triggerType[k],fn:function(n){n.target=d(n.target);n.preventDefault();var m=j.triggerType;if(c.inArray("click",m)&&c.inArray("focus",m)){if(n.type=="focus"){j.toggle();}}else{if(c.inArray("click",m)&&!c.inArray("focus",m)){if(n.type=="click"){j.toggle();}}else{if(!c.inArray("click",m)&&c.inArray("focus",m)){setTimeout(function(){j.toggle();},170);}else{j.toggle();}}}}};l.target.on(l.type,l.fn);}return this;},__getAlignOffset:function(j,n){var k=n.charAt(0),r=n.charAt(1),l,q,m,p,o;if(j){j=f.one(j);l=j.offset();q=j.outerWidth();m=j.outerHeight();}else{l={left:h.scrollLeft(),top:h.scrollTop()};q=h.viewportWidth();m=h.viewportHeight();}p=l.left;o=l.top;if(k==="c"){o+=m/2;}else{if(k==="b"){o+=m;}}if(r==="c"){p+=q/2;}else{if(r==="r"){p+=q;}}return{left:p,top:o};},toggle:function(){var j=this;if(j.con.css("visibility")=="hidden"){j.show();}else{j.hide();}},show:function(){var q=this;q.con.css("visibility","");var o=q.align.points,j=q.align.offset||[0,0],r=q.con.offset(),p=q.__getAlignOffset(q.trigger,o[0]),n=q.__getAlignOffset(q.con,o[1]),m=[n.left-p.left,n.top-p.top],l=r.left-m[0]+j[0],k=r.top-m[1]+j[1];q.con.css("left",l.toString()+"px");q.con.css("top",k.toString()+"px");q.fire("show");return this;},hide:function(){var j=this;j.con.css("visibility","hidden");j.fire("hide");return this;},_buildParam:function(l){var k=this;if(l===b||l===null){l={};}function j(o,n){var m=l[n];k[n]=(m===b||m===null)?o:m;}c.each({date:new Date(),selected:null,startDay:0,pages:1,closable:false,rangeSelect:false,minDate:false,maxDate:false,multiSelect:false,multi:null,navigator:true,popup:false,showTime:false,triggerType:["click"],disabled:null,range:null,rangeLinkage:true,align:{points:["bl","tl"],offset:[0,0]},notLimited:false},j);return this;},_parseParam:function(l){var j=this,k;if(l===b||l===null){l={};}for(k in l){j[k]=l[k];}if(typeof j.triggerType==="string"){j.triggerType=[j.triggerType];}j.startDay=j.startDay%7;if(j.startDay<0){j.startDay+=7;}j.EV=[];j._handleDate();if(j.multiSelect){j.rangeSelect=false;j.range=null;j.selected=null;if(j.multi){for(var k=0;k<j.multi.length;k++){if(j.multi[k] instanceof Date){j.multi[k]=j._handleDate2String(j.multi[k]);}}}}return this;},_templetShow:function(k,q){var n,r,l,j,p,o;if(q instanceof Array){n="";for(l=0;l<q.length;l++){n+=arguments.callee(k,q[l]);}k=n;}else{r=k.match(/{\$(.*?)}/g);if(q!==b&&r!==null){for(l=0,j=r.length;l<j;l++){o=r[l].replace(/({\$)|}/g,"");p=(q[o]!==b)?q[o]:"";k=k.replace(r[l],p);}}}return k;},_handleDate:function(){var j=this,k=j.date;j.weekday=k.getDay()+1;j.day=k.getDate();j.month=k.getMonth();j.year=k.getFullYear();return this;},_handleDate2String:function(m){var k=m.getFullYear();var l=m.getMonth();var j=m.getDate();return k+"-"+(l>8?(l+1):"0"+(l+1))+"-"+(j>9?j:"0"+j);},_handleString2Date:function(l){var j=l.toString().split("-");if(j.length==3){var k=new Date(parseInt(j[0],10),(parseInt(j[1],10)-1),parseInt(j[2],10));if(k instanceof Date&&(k!="Invalid Date")&&!isNaN(k)){return k;}}},_getHeadStr:function(j,k){return j.toString()+"年"+(Number(k)+1).toString()+"月";},_monthAdd:function(){var j=this;if(j.month==11){j.year++;j.month=0;}else{j.month++;}j.date=new Date(j.year.toString()+"/"+(j.month+1).toString()+"/1");return this;},_monthMinus:function(){var j=this;if(j.month===0){j.year--;j.month=11;}else{j.month--;}j.date=new Date(j.year.toString()+"/"+(j.month+1).toString()+"/1");return this;},_yearAdd:function(){var j=this;j.year++;j.date=new Date(j.year.toString()+"/"+(j.month+1).toString()+"/1");return this;},_yearMinus:function(){var j=this;j.year--;j.date=new Date(j.year.toString()+"/"+(j.month+1).toString()+"/1");return this;},_computeNextMonth:function(j){var l=j[0],k=j[1];if(k==11){l++;k=0;}else{k++;}return[l,k];},_handleOffset:function(){var l=this,n=["日","一","二","三","四","五","六"],k="<span>{$day}</span>",p=l.startDay,o="",j=[];for(var m=0;m<7;m++){j[m]={day:n[(m+p)%7]};}o=l._templetShow(k,j);return{day_html:o};},_handleRange:function(l){var j=this,k;j.range=j.range||{start:null,end:null};if((j.range.start===null&&j.range.end===null)||(j.range.start!==null&&j.range.end!==null)){j.range.start=l;j.range.end=null;}else{if(j.range.start!==null&&j.range.end===null){j.range.end=l;if(j.range.start.getTime()>j.range.end.getTime()){k=j.range.start;j.range.start=j.range.end;j.range.end=k;}j.fire("rangeSelect",j.range);if(j.popup&&j.closable){j.hide();}}}return this;},_handleMultiSelectStart:function(k){var j=this;j.multiStart=k;},_handleMultiSelectEnd:function(o){var k=this;if(!k.multiStart){return;}k.multi=k.multi||[];if(o<k.multiStart){k.multiEnd=k.multiStart;k.multiStart=o;}else{k.multiEnd=o;}if(k.minDate&&k.multiStart<k.minDate){k.multiStart=new Date(k.minDate.getFullYear(),k.minDate.getMonth(),k.minDate.getDate());}if(k.maxDate&&k.multiEnd>k.maxDate){k.multiEnd=new Date(k.maxDate.getFullYear(),k.maxDate.getMonth(),k.maxDate.getDate());}while(k.multiStart<=k.multiEnd){var j=false;if(k.disabled&&k.disabled.length>0){for(var l=0;l<k.disabled.length;l++){var m=k.disabled[l];if(m.getTime()==k.multiStart.getTime()){j=true;break;}}}if(j){continue;}var n=k._handleDate2String(k.multiStart);if(!c.inArray(n,k.multi)){k.multi.push(n);}else{k.multi.splice(c.indexOf(n,k.multi),1);}k.multiStart.setDate(k.multiStart.getDate()+1);}k.multiStart=null;k.render();},_handleMultiSelect:function(){var j=this;j.multi=j.multi||[];j.multi.sort(function(m,l){if(m>l){return 1;}return -1;});for(var k=0;k<j.multi.length;k++){j.multi[k]=j._handleString2Date(j.multi[k]);}j.fire("multiSelect",{multi:j.multi});if(j.popup&&j.closable){j.hide();}}});return a;},{requires:["node","event"]});KISSY.add("kscal/page",function(b,a,c){b.augment(c,{Page:function(e,d){this.father=d;this.month=Number(e.month);this.year=Number(e.year);this.prevArrow=e.prevArrow;this.nextArrow=e.nextArrow;this.node=null;this.timmer=null;this.id="";this.html=['<div class="ks-cal-box" id="{$id}">','<div class="ks-cal-hd">','<a href="javascript:void(0);" class="ks-prev-year {$prev}"><</a><a href="javascript:void(0);" class="ks-prev-month {$prev}"><</a>','<a href="javascript:void(0);" class="ks-title">{$title}</a>','<a href="javascript:void(0);" class="ks-next-month {$next}">></a><a href="javascript:void(0);" class="ks-next-year {$next}">></a>',"</div>",'<div class="ks-cal-bd">','<div class="ks-whd">',d._handleOffset().day_html,"</div>",'<div class="ks-dbd ks-clearfix">',"{$ds}",'<div style="clear:both;"></div>',"</div>","</div>",'<div class="ks-setime hidden">',"</div>",'<div class="{$notlimited}"><a href="#" class="ks-cal-notLimited {$notlimitedCls}">不限</a></div>','<div class="ks-multi-select {$multiSelect}"><button class="ks-multi-select-btn">确定</button></div>','<div class="ks-cal-ft {$showtime}">','<div class="ks-cal-time">',"时间：00:00 &hearts;","</div>","</div>",'<div class="ks-selectime hidden">',"</div>","</div><!--#ks-cal-box-->"].join("");this.nav_html=["<p>","月",'<select value="{$the_month}">','<option class="m1" value="1">01</option>','<option class="m2" value="2">02</option>','<option class="m3" value="3">03</option>','<option class="m4" value="4">04</option>','<option class="m5" value="5">05</option>','<option class="m6" value="6">06</option>','<option class="m7" value="7">07</option>','<option class="m8" value="8">08</option>','<option class="m9" value="9">09</option>','<option class="m10" value="10">10</option>','<option class="m11" value="11">11</option>','<option class="m12" value="12">12</option>',"</select>","</p>","<p>","年",'<input type="text" value="{$the_year}" onfocus="this.select()"/>',"</p>","<p>",'<button class="ok">确定</button><button class="cancel">取消</button>',"</p>"].join("");this.Verify=function(){var g=function(i){if(!/^\d+$/i.test(i)){return false;}i=Number(i);return !(i<1||i>31);},f=function(i){if(!/^\d+$/i.test(i)){return false;}i=Number(i);return !(i<100||i>10000);},h=function(i){if(!/^\d+$/i.test(i)){return false;}i=Number(i);return !(i<1||i>12);};return{isDay:g,isYear:f,isMonth:h};};this._renderUI=function(){var h=this,f={},g;h.HTML="";f.prev="";f.next="";f.title="";f.ds="";f.notlimited="";f.notlimitedClass="";if(!h.prevArrow){f.prev="hidden";}if(!h.nextArrow){f.next="hidden";}if(!h.father.showTime){f.showtime="hidden";}if(!h.father.notLimited){f.notlimited="hidden";}if(!h.father.multiSelect){f.multiSelect="hidden";}if(h.father.showTime&&h.father.notLimited){f.notlimitedCls="ks-cal-notLimited-showTime";}if(h.father.notLimited&&!h.father.selected){f.notlimitedCls+=" ks-cal-notLimited-selected";}f.id=h.id="ks-cal-"+Math.random().toString().replace(/.\./i,"");f.title=h.father._getHeadStr(h.year,h.month);h.createDS();f.ds=h.ds;h.father.con.append(h.father._templetShow(h.html,f));h.node=a.one("#"+h.id);if(h.father.showTime){g=h.node.one(".ks-cal-ft");h.timmer=new h.father.TimeSelector(g,h.father);}return this;};this.detachEvent=function(){var f=this;f.EV=f.EV||[];b.each(f.EV,function(g){if(g){g.target.detach(g.type,g.fn);}});};this._buildEvent=function(){var k=this,h,g,f=a.one("#"+k.id);function j(){g.target.on(g.type,g.fn);}k.EV=[];if(!k.father.multiSelect){g=k.EV[k.EV.length]={target:f.one("div.ks-dbd"),type:"click",fn:function(i){i.preventDefault();if(i.target.tagName!="A"){return;}i.target=a(i.target);if(i.target.hasClass("ks-null")){return;}if(i.target.hasClass("ks-disabled")){return;}var l=new Date(k.year,k.month,Number(i.target.html()));k.father.dt_date=l;k.father.fire("select",{date:l});if(k.father.popup&&k.father.closable&&!k.father.showTime&&!k.father.rangeSelect){k.father.hide();}if(k.father.rangeSelect){if(k.timmer){l.setHours(k.timmer.get("h"));l.setMinutes(k.timmer.get("m"));l.setSeconds(k.timmer.get("s"));}k.father._handleRange(l);}k.father.render({selected:l});}};j();}g=k.EV[k.EV.length]={target:f.one("a.ks-prev-month"),type:"click",fn:function(i){i.preventDefault();if(!k.father.rangeLinkage){k._monthMinus();}k.father._monthMinus().render();k.father.fire("monthChange",{date:new Date(k.father.year+"/"+(k.father.month+1)+"/01")});}};j();g=k.EV[k.EV.length]={target:f.one("a.ks-next-month"),type:"click",fn:function(i){i.preventDefault();if(!k.father.rangeLinkage){k._monthAdd();}k.father._monthAdd().render();k.father.fire("monthChange",{date:new Date(k.father.year+"/"+(k.father.month+1)+"/01")});}};j();g=k.EV[k.EV.length]={target:f.one("a.ks-prev-year"),type:"click",fn:function(i){i.preventDefault();if(!k.father.rangeLinkage){k._yearMinus();}k.father._yearMinus().render();k.father.fire("monthChange",{date:new Date(k.father.year+"/"+(k.father.month+1)+"/01")});}};j();g=k.EV[k.EV.length]={target:f.one("a.ks-next-year"),type:"click",fn:function(i){i.preventDefault();if(!k.father.rangeLinkage){k._yearAdd();}k.father._yearAdd().render();k.father.fire("monthChange",{date:new Date(k.father.year+"/"+(k.father.month+1)+"/01")});}};j();if(k.father.navigator){g=k.EV[k.EV.length]={target:f.one("a.ks-title"),type:"click",fn:function(l){try{k.timmer.hidePopup();l.preventDefault();}catch(n){}l.target=a(l.target);var m=f.one(".ks-setime");m.html("");var i=k.father._templetShow(k.nav_html,{the_month:k.month+1,the_year:k.year});m.html(i);m.removeClass("hidden");f.one("input").on("keydown",function(q){q.target=a(q.target);if(q.keyCode==38){q.target.val(Number(q.target.val())+1);q.target[0].select();}if(q.keyCode==40){q.target.val(Number(q.target.val())-1);q.target[0].select();}if(q.keyCode==13){var p=f.one(".ks-setime").one("select").val();var o=f.one(".ks-setime").one("input").val();f.one(".ks-setime").addClass("hidden");if(!k.Verify().isYear(o)){return;}if(!k.Verify().isMonth(p)){return;}k.father.render({date:new Date(o+"/"+p+"/01")});k.father.fire("monthChange",{date:new Date(o+"/"+p+"/01")});}});}};j();g=k.EV[k.EV.length]={target:f.one(".ks-setime"),type:"click",fn:function(m){m.preventDefault();m.target=a(m.target);if(m.target.hasClass("ok")){var l=f.one(".ks-setime").one("select").val(),i=f.one(".ks-setime").one("input").val();f.one(".ks-setime").addClass("hidden");if(!k.Verify().isYear(i)){return;}if(!k.Verify().isMonth(l)){return;}k.father.render({date:new Date(i+"/"+l+"/01")});k.father.fire("monthChange",{date:new Date(i+"/"+l+"/01")});}else{if(m.target.hasClass("cancel")){f.one(".ks-setime").addClass("hidden");}}}};j();}if(k.father.notLimited){g=k.EV[k.EV.length]={target:f.one(".ks-cal-notLimited"),type:"click",fn:function(i){i.preventDefault();k.father.range={start:null,end:null};k.father.fire("select",{date:null});if(k.father.popup&&k.father.closable){k.father.hide();}k.father.render({selected:null});}};j();}if(k.father.multiSelect){g=k.EV[k.EV.length]={target:f.one("div.ks-dbd"),type:"mousedown",fn:function(i){i.preventDefault();if(i.target.tagName!="A"){return;}i.target=a(i.target);if(i.target.hasClass("ks-null")){return;}if(i.target.hasClass("ks-disabled")){return;}var l=new Date(k.year,k.month,Number(i.target.html()));k.father._handleMultiSelectStart(l);}};j();g=k.EV[k.EV.length]={target:f.one("div.ks-dbd"),type:"mouseup",fn:function(i){i.preventDefault();if(i.target.tagName!="A"){return;}i.target=a(i.target);if(i.target.hasClass("ks-null")){return;}if(i.target.hasClass("ks-disabled")){return;}var l=new Date(k.year,k.month,Number(i.target.html()));k.father._handleMultiSelectEnd(l);}};j();g=k.EV[k.EV.length]={target:f.one(".ks-multi-select-btn"),type:"click",fn:function(i){i.preventDefault();k.father._handleMultiSelect();}};j();}return this;};this._monthAdd=function(){var f=this;if(f.month==11){f.year++;f.month=0;}else{f.month++;}},this._monthMinus=function(){var f=this;if(f.month===0){f.year--;f.month=11;}else{f.month--;}},this._yearAdd=function(){var f=this;f.year++;};this._yearMinus=function(){var f=this;f.year--;};this._getNode=function(){var f=this;return f.node;};this._getNumOfDays=function(f,g){return 32-new Date(f,g-1,32).getDate();};this._isDisabled=function(f,g){if(f&&f.length>0){for(var h=0;h<f.length;h++){var j=f[h];if(g.getFullYear()==j.getFullYear()&&g.getMonth()==j.getMonth()&&g.getDate()==j.getDate()){return true;}}}return false;};this.isInMulit=function(j,g){if(j&&j.length>0){for(var h=0;h<j.length;h++){var f=j[h].split("-");if(g.getFullYear()==parseInt(f[0],10)&&g.getMonth()==(parseInt(f[1],10)-1)&&g.getDate()==parseInt(f[2],10)){return true;}}}return false;};this.createDS=function(){var h=this,p="",l=(7-h.father.startDay+new Date(h.year+"/"+(h.month+1)+"/01").getDay())%7,n=h._getNumOfDays(h.year,h.month+1),j=h.father.selected,m=new Date(),k,f;for(var k=0;k<l;k++){p+='<a href="javascript:void(0);" class="ks-null">0</a>';}for(k=1;k<=n;k++){var o="";var g=new Date(h.year,h.month,k);if((h.father.minDate&&new Date(h.year,h.month,k+1)<=h.father.minDate)||(h.father.maxDate&&g>h.father.maxDate)||h._isDisabled(h.father.disabled,g)){o="ks-disabled";}else{if(h.father.range&&g>=h.father.range.start&&g<=h.father.range.end){o="ks-range";}else{if((j&&j.getFullYear()==h.year&&j.getMonth()==h.month&&j.getDate()==k)||h.isInMulit(h.father.multi,g)){o="ks-selected";}}}if(m.getFullYear()==h.year&&m.getMonth()==h.month&&m.getDate()==k){o+=" ks-today";}p+="<a "+(o?'class="'+o+'"':"")+' href="javascript:void(0);">'+k+"</a>";}h.ds=p;return this;};this.render=function(){var f=this;f._renderUI();f._buildEvent();return this;};}});return c;},{requires:["node","kscal/base"]});KISSY.add("kscal/time",function(b,a,c){b.augment(c,{TimeSelector:function(e,d){this.father=d;this.fcon=e.parent(".ks-cal-box");this.popupannel=this.fcon.one(".ks-selectime");if(typeof d._time=="undefined"){d._time=new Date();}this.time=d._time;this.status="s";this.ctime=a('<div class="ks-cal-time">时间：<span class="h">h</span>:<span class="m">m</span>:<span class="s">s</span><!--{{arrow--><div class="cta"><button class="u"></button><button class="d"></button></div><!--arrow}}--></div>');this.button=a('<button class="ct-ok">确定</button>');this.h_a=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"];this.m_a=["00","10","20","30","40","50"];this.s_a=["00","10","20","30","40","50"];this.parseSubHtml=function(f){var h="";for(var g=0;g<f.length;g++){h+='<a href="javascript:void(0);" class="item">'+f[g]+"</a>";}h+='<a href="javascript:void(0);" class="x">x</a>';return h;};this.showPopup=function(g){var h=this;this.popupannel.html(g);this.popupannel.removeClass("hidden");var f=h.status;h.ctime.all("span").removeClass("on");switch(f){case"h":h.ctime.all(".h").addClass("on");break;case"m":h.ctime.all(".m").addClass("on");break;case"s":h.ctime.all(".s").addClass("on");break;}};this.hidePopup=function(){this.popupannel.addClass("hidden");};this.render=function(){var g=this;var j=g.get("h");var f=g.get("m");var i=g.get("s");g.father._time=g.time;g.ctime.all(".h").html(j);g.ctime.all(".m").html(f);g.ctime.all(".s").html(i);return g;};this.set=function(f,h){var g=this;h=Number(h);switch(f){case"h":g.time.setHours(h);break;case"m":g.time.setMinutes(h);break;case"s":g.time.setSeconds(h);break;}g.render();};this.get=function(f){var g=this;var h=g.time;switch(f){case"h":return h.getHours();case"m":return h.getMinutes();case"s":return h.getSeconds();}};this.add=function(){var h=this;var f=h.status;var g=h.get(f);g++;h.set(f,g);};this.minus=function(){var h=this;var f=h.status;var g=h.get(f);g--;h.set(f,g);};this._init=function(){var f=this;e.html("").append(f.ctime);e.append(f.button);f.render();f.popupannel.on("click",function(i){var h=a(i.target);if(h.hasClass("x")){f.hidePopup();}else{if(h.hasClass("item")){var g=Number(h.html());f.set(f.status,g);f.hidePopup();}}});f.button.on("click",function(){var g=typeof f.father.dt_date=="undefined"?f.father.date:f.father.dt_date;g.setHours(f.get("h"));g.setMinutes(f.get("m"));g.setSeconds(f.get("s"));f.father.fire("timeSelect",{date:g});if(f.father.popup&&f.father.closable){f.father.hide();}});f.ctime.on("keyup",function(g){if(g.keyCode==38||g.keyCode==37){g.preventDefault();f.add();}if(g.keyCode==40||g.keyCode==39){g.preventDefault();f.minus();}});f.ctime.one(".u").on("click",function(){f.hidePopup();f.add();});f.ctime.one(".d").on("click",function(){f.hidePopup();f.minus();});f.ctime.one(".h").on("click",function(){var g=f.parseSubHtml(f.h_a);f.status="h";f.showPopup(g);});f.ctime.one(".m").on("click",function(){var g=f.parseSubHtml(f.m_a);f.status="m";f.showPopup(g);});f.ctime.one(".s").on("click",function(){var g=f.parseSubHtml(f.s_a);f.status="s";f.showPopup(g);});};this._init();}});return c;},{requires:["node","kscal/base"]});KISSY.add("kscal/date",function(b){function c(g,f){var e=null;f=f||"-";if(!(e instanceof Date)){e=new Date(g);}else{return e;}if(e instanceof Date&&(e!="Invalid Date")&&!isNaN(e)){return e;}else{var d=g.toString().split(f);if(d.length==3){e=new Date(d[0],(parseInt(d[1],10)-1),d[2]);if(e instanceof Date&&(e!="Invalid Date")&&!isNaN(e)){return e;}}}return null;}var a=function(){var e=/w{1}|d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,f=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,i=/[^-+\dA-Z]/g,h=function(k,j){k=String(k);j=j||2;while(k.length<j){k="0"+k;}return k;},d={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUTCDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",localShortDate:"yy年mm月dd日",localShortDateTime:"yy年mm月dd日 hh:MM:ss TT",localLongDate:"yyyy年mm月dd日",localLongDateTime:"yyyy年mm月dd日 hh:MM:ss TT",localFullDate:"yyyy年mm月dd日 w",localFullDateTime:"yyyy年mm月dd日 w hh:MM:ss TT"},g={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","星期日","星期一","星期二","星期三","星期四","星期五","星期六"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};return function(n,A,v){if(arguments.length==1&&Object.prototype.toString.call(n)=="[object String]"&&!/\d/.test(n)){A=n;n=undefined;}n=n?new Date(n):new Date();if(isNaN(n)){throw SyntaxError("invalid date");}A=String(d[A]||A||d["default"]);if(A.slice(0,4)=="UTC:"){A=A.slice(4);v=true;}var x=v?"getUTC":"get",r=n[x+"Date"](),j=n[x+"Day"](),p=n[x+"Month"](),u=n[x+"FullYear"](),w=n[x+"Hours"](),q=n[x+"Minutes"](),z=n[x+"Seconds"](),t=n[x+"Milliseconds"](),k=v?0:n.getTimezoneOffset(),l={d:r,dd:h(r,undefined),ddd:g.dayNames[j],dddd:g.dayNames[j+7],w:g.dayNames[j+14],m:p+1,mm:h(p+1,undefined),mmm:g.monthNames[p],mmmm:g.monthNames[p+12],yy:String(u).slice(2),yyyy:u,h:w%12||12,hh:h(w%12||12,undefined),H:w,HH:h(w,undefined),M:q,MM:h(q,undefined),s:z,ss:h(z,undefined),l:h(t,3),L:h(t>99?Math.round(t/10):t,undefined),t:w<12?"a":"p",tt:w<12?"am":"pm",T:w<12?"A":"P",TT:w<12?"AM":"PM",Z:v?"UTC":(String(n).match(f)||[""]).pop().replace(i,""),o:(k>0?"-":"+")+h(Math.floor(Math.abs(k)/60)*100+Math.abs(k)%60,4),S:["th","st","nd","rd"][r%10>3?0:(r%100-r%10!=10)*r%10]};return A.replace(e,function(m){return m in l?l[m]:m.slice(1,m.length-1);});};}();return{format:function(e,d,f){return a(e,d,f);},parse:function(d,e){return c(d,e);}};});KISSY.add("kscal/index",function(c,e,b,d,a){e.Date=a;c.Calendar=e;return e;},{requires:["kscal/base","kscal/page","kscal/time","kscal/date"]});