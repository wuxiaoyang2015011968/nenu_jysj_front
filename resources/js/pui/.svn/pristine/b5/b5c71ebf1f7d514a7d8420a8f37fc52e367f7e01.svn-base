KISSY.add("mod/overlay",function(c,b){var d=function(){},a={renderTo:"",content:"",elCls:"",elStyle:"",zIndex:101,opacity:0.6,bgColor:"#000",topLayer:0,cursor:"wait",showAfterReady:false,onClick:d,beforeRender:d,afterRender:d,onVisibleChange:d,beforeDestroy:d,afterDestroy:d,clickHandler:d,beforeCreateHandler:d,afterCreateHandler:d,beforeDestroyHandler:d,afterDestroyHandler:d};PW.namespace("mod.Overlay");PW.namespace("overlay");PW.namespace("Overlay");PW.Overlay=PW.overlay=PW.mod.Overlay=function(f){var e=c.merge(a,f);return new b(e).on("click",function(g){if(c.isFunction(e.onClick)){e.onClick(g,this);}else{if(c.isFunction(e.clickHandler)){e.clickHandler(g,this);}}}).on("beforeRender",function(g){if(c.isFunction(e.beforeRender)){e.beforeRender(g,this);}else{if(c.isFunction(e.beforeCreateHandler)){e.beforeCreateHandler(g,this);}}}).on("afterRender",function(g){if(c.isFunction(e.afterRender)){e.afterRender(g,this);}else{if(c.isFunction(e.afterCreateHandler)){e.afterCreateHandler(g,this);}}}).on("beforeDestroy",function(g){if(c.isFunction(e.beforeDestroy)){e.beforeDestroy(g,this);}else{if(c.isFunction(e.beforeDestroyHandler)){e.beforeDestroyHandler(g,this);}}}).on("afterDestroy",function(g){if(c.isFunction(e.afterDestroy)){e.afterDestroy(g,this);}else{if(c.isFunction(e.afterDestroyHandler)){e.afterDestroyHandler(g,this);}}}).on("visibleChange",function(g){if(c.isFunction(e.onVisibleChange)){e.onVisibleChange(g,this);}});};PW.namespace("mask");PW.namespace("Mask");PW.namespace("mod.Mask");PW.Mask=PW.mask=PW.mod.Mask=function(h,e,f,g){return PW.overlay({zIndex:h,bgColor:e,topLayer:f,onClick:g});};},{requires:["overlay/core"]});KISSY.add("overlay/core",function(c){var k=c.DOM,b=k.get,g=k.query,e=jQuery,f=c.Event.on,i=k.nodeName,j={},d=0,h="data-overlay-id";function a(l){this.opts=c.merge(j,l);this.id=d++;this.opts;this.prtEl;this.w;this.h;this.win;this.doc;this.olyEl;this.visibleStatus=false;this.init(l);}c.augment(a,c.EventTarget,{init:function(n){var m=this,l=m.opts;m._getWin();m.prtEl=m._getPrtEl();m._render();if(l.showAfterReady){m.show();}},render:function(){var l=this;l.refresh();l.show();},refresh:function(){var l=this;if(l.olyEl){l._refreshProp();}else{l._render();}},show:function(){var l=this,m=l.olyEl;if(!l.visibleStatus){k.show(m);l.visibleStatus=true;l.fire("visibleChange",l._getEvtProp());}},hide:function(){var l=this;if(l.visibleStatus){k.hide(l.olyEl);l.visibleStatus=false;l.fire("visibleChange",l._getEvtProp());}},destroy:function(){var l=this,m=l.olyEl;l.fire("beforeDestroy",l._getEvtProp());k.remove(m);l.fire("afterDestroy",l._getEvtProp());},setContent:function(l){var m=this,n=m.olyEl;m.removeContent();if(c.isString(l)){k.html(n,l);}else{k.append(l,n);}},removeContent:function(){var l=this,m=l.olyEl;k.html(m,"");},_render:function(){var l=this,m=l.doc;l._createOlyEl();l.fire("beforeRender",l._getEvtProp());k.append(l.iframeEl,l.olyEl);k.append(l.olyEl,l.prtEl);l._bindEvt();l.fire("afterRender",l._getEvtProp());},_bindEvt:function(){var l=this,m=l.olyEl;f(m,"click",function(n){var o=l._getEvtProp();l.fire("click",c.mix(o,n));});},_refreshProp:function(){var l=this,n=l.olyEl,m=l._getPrtProp();k.height(n,m.h);k.width(n,m.w);l.w=m.w;l.h=m.h;},_getPrtProp:function(){var q=this,o=q.prtEl,p={};p.w=k.outerWidth(o);if(i(o,"body")){var l=e(q.win).height(),m,s=e(q.doc).height(),n=e('<div style="height: 0;"></div>');e(o).append(n);m=n.offset().top;n.remove();if(s>=l&&s>=m){p.h=s;}else{if(l>=s&&l>=m){p.h=l;}else{c.log("高度混乱");}}}else{p.h=k.innerHeight(o);}return p;},_createOlyEl:function(){var n=this,m=n.opts,r=n.doc,q=n.win,l,o=n._getPrtProp();n.olyEl=k.create("<div>",{"class":m.elCls,html:m.content,"data-overlay-id":n.id,css:c.mix({display:"none",position:"absolute",left:0,top:0,width:o.w,height:o.h,cursor:m.cursor,background:m.bgColor,opacity:m.opacity,filter:"alpha(opacity="+m.opacity*100+")",zIndex:m.zIndex},m.elStyle)},n.doc);n.w=o.w;n.h=o.h;if(e.browser.msie&&e.browser.version==6){n.iframeEl=k.create("<iframe>",{frameborder:0,css:{position:"absolute",top:0,left:0,opacity:0,"z-index":-1,height:o.h,width:o.w,border:0}},n.doc);}},_getPrtEl:function(){var m=this,l=m.opts,o=m.doc,n;n=b(l.renderTo,o)||b("body",o);if(!i(n,"body")){k.css(n,{position:"relative",zoom:"1"});}f(n,"x-resize",function(){m.refresh();m.fire("resize",m._getEvtProp());});return n;},_getWin:function(){var o=this,n=o.opts,m=n.topLayer,p=window;for(var l=0;l<m;l++){p=p.parent;}o.win=p;o.doc=p.document;},_getEvtProp:function(){var l=this;return{pEl:l.prtEl,el:l.olyEl,iframeEl:l.iframeEl,win:l.win,doc:l.doc,ol:l.olyEl,ob:l,tw:l.win,o:l};}});return a;},{requires:["core","thirdparty/jquery","mod/ext","sizzle"]});